<oui-message
    id="error-message"
    data-ng-show="$ctrl.errorMessage"
    type="error"
    dismissable="true"
    on-dismiss="$ctrl.errorMessage = null;"
>
    <span data-ng-bind-html="$ctrl.errorMessage"></span>
</oui-message>

<section id="upscaleSection" class="container-fluid mt-4 ml-4">
    <oui-header
        id="vps-upscale-title"
        data-heading="{{:: 'vps_upscale_title' |translate}}"
    >
    </oui-header>
    <p data-translate="vps_upscale_change_configuration_details"></p>

    <!-- Range(flavor) selection -->
    <h3 class="mt-2" data-translate="vps_upscale_choice_model"></h3>
    <p data-translate="vps_upscale_choice_model_details"></p>
    <div class="row d-md-flex flex-wrap">
        <div
            class="col-md-3 my-3"
            data-ng-repeat="range in $ctrl.upscaleRanges track by range.formattedName"
        >
            <oui-select-picker
                class="h-100"
                name="range.formattedName"
                model="$ctrl.range"
                values="[range]"
                disabled="$ctrl.constructor.isRangeDisabled(range)"
                variant="light"
            >
                <oui-select-picker-description>
                    <div class="text-center">
                        <h4 data-ng-bind="range.formattedName"></h4>
                        <!-- Min Price -->
                        <div>
                            <small
                                class="d-block"
                                data-translate="vps_upscale_from_on"
                            ></small>
                            <strong
                                data-ng-bind="$ctrl.getModelPrice(range.indicativePricing.price)"
                            >
                            </strong>
                            <small
                                data-translate="vps_upscale_per_month"
                            ></small>
                        </div>
                        <!-- CPU -->
                        <div class="mt-2">
                            <span
                                data-ng-bind="range.formattedTechnical.cpu"
                            ></span>
                            <span
                                data-translate="{{:: range.formattedTechnical.cpu === 1 ? 'vps_dashboard_vcore_1' : 'vps_dashboard_vcore_other'}}"
                            ></span>
                        </div>

                        <!-- Memory -->
                        <div>
                            <span
                                data-ng-if="!range.formattedTechnical.memory.minEqualMax"
                                data-translate="vps_upscale_range_memory_capacity"
                                data-translate-values="{
                                'max': range.formattedTechnical.memory.max,
                                'min': range.formattedTechnical.memory.min,
                            }"
                            ></span>
                            <span
                                data-ng-if="range.formattedTechnical.memory.minEqualMax"
                                data-translate="vps_upscale_choice_configuration_quantity"
                                data-translate-values="{
                                    'unit': range.formattedTechnical.memory.min,
                                }"
                            ></span>
                        </div>
                        <!-- Storage -->
                        <div>
                            <span
                                data-ng-if="!range.formattedTechnical.storage.minEqualMax"
                                data-translate="vps_upscale_range_storage_capacity"
                                data-translate-values="{
                                'max': range.formattedTechnical.storage.max,
                                'min': range.formattedTechnical.storage.min,
                                }"
                            ></span>
                            <span
                                data-ng-if="range.formattedTechnical.storage.minEqualMax"
                                data-translate="vps_upscale_choice_configuration_quantity"
                                data-translate-values="{
                                    'unit': range.formattedTechnical.storage.min,
                                }"
                            ></span>
                        </div>
                        <!-- Bandwidth -->
                        <div>
                            <span
                                data-ng-bind="range.formattedTechnical.bandwidth | bandwidth:'M':'bit'"
                            >
                            </span>
                        </div>
                    </div>
                </oui-select-picker-description>
            </oui-select-picker>
        </div>
    </div>

    <!-- Flavor configuration -->
    <h3 class="mt-2" data-translate="vps_upscale_choice_configuration"></h3>
    <p data-translate="vps_upscale_choice_configuration_details"></p>
    <div>
        <p data-translate="vps_upscale_change_configuration_indication"></p>
        <table class="table pr-5">
            <thead>
                <tr>
                    <th
                        scope="col"
                        data-translate="vps_upscale_choice_configuration_cpu"
                    ></th>
                    <th
                        scope="col"
                        data-translate="vps_upscale_choice_configuration_memory"
                    ></th>
                    <th
                        scope="col"
                        data-translate="vps_upscale_choice_configuration_storage"
                    ></th>
                    <th
                        scope="col"
                        data-translate="vps_upscale_choice_configuration_bandwidth"
                    ></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="align-top">
                        <oui-select-picker
                            class="mt-2"
                            data-ng-init="$ctrl.initRangeConfiguration($ctrl.getAvailableValuesForParameter($ctrl.range.technicals, 'cpu.cores'), 'cores')"
                            data-ng-repeat="core in $ctrl.getAvailableValuesForParameter($ctrl.range.technicals, 'cpu.cores') track by core"
                            model="$ctrl.rangeConfiguration.cores"
                            name="{{:: memory }}"
                            label="{{:: 'vps_upscale_choice_configuration_cpu_vcores' | translate:{ 'vcores': core } }}"
                            data-values="[core]"
                            on-change="$ctrl.getRangeFlavorConfigurationPricing()"
                            variant="light"
                        >
                        </oui-select-picker>
                    </td>
                    <td class="align-top">
                        <oui-select-picker
                            class="mt-2"
                            data-ng-init="$ctrl.initRangeConfiguration($ctrl.getAvailableValuesForParameter($ctrl.range.technicals, 'memory.size'), 'memory')"
                            data-ng-repeat="memory in $ctrl.getAvailableValuesForParameter($ctrl.range.technicals, 'memory.size') track by memory"
                            model="$ctrl.rangeConfiguration.memory"
                            name="{{:: memory }}"
                            label="{{:: 'vps_upscale_choice_configuration_quantity' | translate:{ unit: memory } }}"
                            data-values="[memory]"
                            on-change="$ctrl.getRangeFlavorConfigurationPricing()"
                            variant="light"
                        >
                        </oui-select-picker>
                    </td>
                    <td class="align-top">
                        <oui-select-picker
                            class="mt-2"
                            data-ng-repeat="storage in $ctrl.getAvailableValuesForParameter($ctrl.range.technicals, 'storage.disks[0].capacity') track by storage"
                            model="$ctrl.rangeConfiguration.storage"
                            name="{{:: storage }}"
                            label="{{:: 'vps_upscale_choice_configuration_quantity' | translate:{ unit: storage } }}"
                            data-values="[storage]"
                            data-disabled="$ctrl.isStorageSelectionDisabled(storage)"
                            on-change="$ctrl.getRangeFlavorConfigurationPricing()"
                            variant="light"
                        >
                        </oui-select-picker>
                    </td>
                    <td class="align-top">
                        <oui-select-picker
                            class="mt-2"
                            data-ng-init="$ctrl.initRangeConfiguration($ctrl.getAvailableValuesForParameter($ctrl.range.technicals, 'bandwidth.level'), 'bandwidth')"
                            data-ng-repeat="bandwidth in $ctrl.getAvailableValuesForParameter($ctrl.range.technicals, 'bandwidth.level') track by bandwidth"
                            model="$ctrl.rangeConfiguration.bandwidth"
                            name="{{:: bandwidth }}"
                            label="{{:: bandwidth | bandwidth:'M':'bit' }}"
                            data-values="[bandwidth]"
                            on-change="$ctrl.getRangeFlavorConfigurationPricing()"
                            variant="light"
                        >
                        </oui-select-picker>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Order summary -->
    <h3 class="mt-2" data-translate="vps_upscale_summary"></h3>
    <p data-translate=""></p>
    <div class="row">
        <vps-upscale-summary-configuration
            class="col-md-3"
            connected-user="$ctrl.connectedUser"
            configuration="$ctrl.currentRangeConfiguration"
            highlight="false"
            summary-title="{{:: 'vps_upscale_summary_current_configuration_' + $ctrl.currentRangeConfiguration.pricing.pricingMode | translate:{ 'month': $ctrl.currentRangeConfiguration.pricing.interval } }}"
        >
        </vps-upscale-summary-configuration>
        <vps-upscale-summary-configuration
            class="col-md-3"
            data-ng-if="$ctrl.newRangeInformation"
            connected-user="$ctrl.connectedUser"
            configuration="$ctrl.newRangeInformation"
            highlight="true"
            summary-title="{{:: 'vps_upscale_summary_final_configuration_' + $ctrl.newRangeInformation.pricing.paymentType | translate:{ 'month': $ctrl.newRangeInformation.pricing.interval } }}"
        >
        </vps-upscale-summary-configuration>
    </div>
    <div class="row mt-2" data-ng-if="$ctrl.newRangeInformation && $ctrl.order">
        <div class="col-md-6">
            <vps-upscale-summary-price
                language="$ctrl.connectedUser.language"
                payment-type="$ctrl.newRangeInformation.pricing.paymentType"
                price="{
                  currency: $ctrl.connectedUser.currency.code,
                  unit: $ctrl.order.prices.withoutTax.unit,
                  value: $ctrl.order.prices.withoutTax.value,
                }"
            >
            </vps-upscale-summary-price>
            <p
                data-translate="{{:: $ctrl.getValidationInformation() }}"
                data-translate-values="{
                  'price': '<strong>' + $ctrl.order.prices.withoutTax.text + '</strong>'
                }"
            ></p>
        </div>
    </div>

    <!-- Order agreement -->
    <div data-ng-if="$ctrl.order">
        <oui-checkbox
            model="$ctrl.agreeContracts"
            data-ng-if="$ctrl.order && $ctrl.agreements"
        >
            <span
                data-translate="vps_upscale_agreements"
                data-translate-values="{
                    'conditions': $ctrl.agreements.termsOfService,
                    'policy': $ctrl.agreements.privacyPolicy
                  }"
            ></span>
        </oui-checkbox>
        <ovh-contracts-summary
            data-ng-if="$ctrl.order && !$ctrl.agreements"
            items="$ctrl.order.contracts"
            model="$ctrl.agreeContracts"
        ></ovh-contracts-summary>
    </div>

    <!-- Submit/cancel buttons -->
    <p data-translate="vps_upscale_new_configuration_refresh_time"></p>
    <div class="row">
        <oui-button
            data-type="button"
            size="l"
            class="offset-md-8 offset-sm-8 mr-2"
            data-variant="secondary"
            on-click="$ctrl.goBack()"
        >
            <span
                data-translate="vps_upscale_choice_configuration_cancel"
            ></span>
        </oui-button>
        <oui-button
            type="submit"
            size="l"
            variant="primary"
            disabled="!($ctrl.newRangeInformation.pricing && $ctrl.agreeContracts)"
            on-click="$ctrl.performUpscaleService()"
        >
            <span
                data-translate="vps_upscale_choice_configuration_validate"
            ></span>
        </oui-button>
    </div>
</section>
